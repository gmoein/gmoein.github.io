<!DOCTYPE html>
<html>

<head>
    <title>رستافوم دیزاینر</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="bootstrap.min.css">
    <script src="jquery.min.js"></script>
    <script src="popper.min.js"></script>
    <script src="bootstrap.min.js"></script>
    <style>
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 25px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }
        
        .slider:hover {
            opacity: 1;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            background: #4CAF50;
            cursor: pointer;
        }
        
        .slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            background: #4CAF50;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="container pt-1">
        <div class="btn-group">
            <button class="btn btn-outline-secondary"  style="font-family:'B Yekan'" onclick="document.getElementById('fileopenx').click()">فایل</i></button>
            <button class="btn btn-outline-secondary"  style="font-family:'B Yekan'" onclick="filesavehandle()">ذخیره</i></button>
            <button class="btn btn-outline-secondary"  style="font-family:'B Yekan'" onclick="filedownload()">خروجی</i></button>
            <button type="button" class="btn btn-outline-secondary" style="font-family:'B Yekan'"  data-toggle="modal" data-target="#exampleModal">تنظیمات</button>
            <button type="button" class="btn btn-outline-secondary dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
            <ul class="dropdown-menu p-2" role="menu">
                <li>
                    <p style="font-family:'B Yekan'" id="paramoption">ایجاد</p>
                </li>
                <li>
                    <button type="button" class="btn btn-outline-secondary" style="font-family:'B Yekan';width: 100%;" onclick="linecheck(1)"> ایجاد </label>
                </li>
                <li>
                    <button type="button" class="btn btn-outline-secondary" style="font-family:'B Yekan';width: 100%" onclick="linecheck(2)"> تغییر پارامتر اول </label>
                </li>
                <li>
                    <button type="button" class="btn btn-outline-secondary" style="font-family:'B Yekan';width: 100%" onclick="linecheck(3)"> تغییر پارامتر دوم </label>
                </li>
                <li>
                    <button type="button" class="btn btn-outline-secondary" style="font-family:'B Yekan';width: 100%" onclick="linecheck(4)"> تغییر پارامتر سوم </label>
                </li>
                <li>
                    <button type="button" class="btn btn-outline-secondary" style="font-family:'B Yekan';width: 100%" onclick="linecheck(5)"> تغییر پارامتر چهارم </label>
                </li>
                <li>
                    <input type="text" class="form-control">
                </li>
                <li>
                    <button type="button" class="btn btn-outline-secondary" style="font-family:'B Yekan';width: 100%;" onclick="linecheck(10)"> اعمال </label>
                </li>

            </ul>
        </div>
    </div>
    <div class="container pt-1">
        <div class="btn-group">
            <button type="button" class="btn btn-outline-secondary" style="font-family:'B Yekan'" onclick="btnshapetool(1)">خط
            </button>

            <!--button type="button" class="btn btn-outline-secondary" style="font-family:'B Yekan'" onclick="btnshapetool(2)">دایره</button-->
            <button type="button" class="btn btn-outline-secondary" style="font-family:'B Yekan'" onclick="btnshapetool(3)">کمان</button>
            <button type="button" class="btn btn-outline-secondary" style="font-family:'B Yekan'" onclick="btnshapetool(4)">بازیر</button>
            <button type="button" class="btn btn-outline-secondary" style="font-family:'B Yekan'" onclick="btnshapetool(5)">موج</button>
            <button type="button" class="btn btn-outline-secondary" style="font-family:'B Yekan'" onclick="btnshapetool(6)">چین</button>


        </div>
    </div>
    
    <div class="container pt-1">
        <div class="btn-group">
                <button class="btn btn-outline-secondary"  style="font-family:'B Yekan'" onclick="document.getElementById('avatar').click()">عکس</i></button>
           
                <button class="btn btn-outline-secondary"  style="font-family:'B Yekan'" onclick="btndeltool()">حذف</i></button>

                <button class="btn btn-outline-secondary"  style="font-family:'B Yekan'" onclick="btnnextgallery()">قبلی</i></button>

                <button class="btn btn-outline-secondary"  style="font-family:'B Yekan'" onclick="btnpregallery()">بعدی</i></button>
                <button class="btn btn-outline-secondary"  style="font-family:'B Yekan'" onclick="btnsavegallery()">توسعه</i></button>
                
            
        </div>
    </div>
    <div class="container pt-1">
        <div class="btn-group">
            <button class="btn btn-outline-secondary"  style="font-family:'B Yekan'"onclick="btnselback()">عقب</i></button>
            <button class="btn btn-outline-secondary"  style="font-family:'B Yekan'" onclick="btnselfw()">جلو</i></button>
             <button class="btn btn-outline-secondary"  style="font-family:'B Yekan'" onclick="btnzintool()">زوم</i></button>
            <button class="btn btn-outline-secondary"  style="font-family:'B Yekan'" onclick="btnzouttool()">کوچک کردن</i></button>

        </div>
    </div>
    <div class="container pt-1">
        <div class="btn-group">
            <button class="btn btn-outline-secondary"  style="font-family:'B Yekan'" onclick="btnpantool(1)">چپ
            </button>
            <button class="btn btn-outline-secondary"  style="font-family:'B Yekan'" onclick="btnpantool(2)">راست
            </button>
            <button class="btn btn-outline-secondary"  style="font-family:'B Yekan'" onclick="btnpantool(3)">پایین
            </button>
            <button class="btn btn-outline-secondary"  style="font-family:'B Yekan'" onclick="btnpantool(4)">بالا
            </button>
            <button class="btn btn-outline-secondary"  style="font-family:'B Yekan'" onclick="btnpantool(5)">ریست
            </button>
        </div>
    </div>
    <div class="container pt-1">
        <div class="btn-group">
                <select class="form-control"  style="font-family:'B Yekan'" id="sel2">
                    <option style="font-family:'B Yekan'">جابجایی</option>
                    <option style="font-family:'B Yekan'">تغییر پارامتر 1</option>
                    <option style="font-family:'B Yekan'">تغییر پارامتر 2</option>
                    <option style="font-family:'B Yekan'">تغییر پارامتر 3</option>
                    <option style="font-family:'B Yekan'">تغییر پارامتر 4</option>
                    <option style="font-family:'B Yekan'">تغییر پارامتر 5</option>
                    <option style="font-family:'B Yekan'">جابجایی عکس</option>
                    <option style="font-family:'B Yekan'">زوم عکس</option>
                </select>
            </div>
        </div>
    <div class="container pt-1">
        <div class="row">
            <div class="col-11">
                <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="myRange" oninput="rangechange()">
            </div>
            <div class="col-1">
                <button type="button" class="btn btn-outline-secondary"  style="font-family:'B Yekan'" data-toggle="modal" data-target="#myModal">تنظیمات</button>
            </div>
        </div>

    </div>
    <div class="container pt-1" id="canvcont">
        <canvas id="myCanvas"></canvas>
    </div>
    <div class="container pt-2">
        <div class="row">
            <div class="col-sm-12">
                <textarea class="form-control" rows="5" id="comment" style="font-family:'B Yekan'"></textarea>
            </div>
        </div>
    </div>
    <input type="file" id="avatar" name="avatar" style="display:none" accept="image/png, image/jpeg">
    <input type="file" id="fileopenx" name="fileopenx" style="display:none" accept=".aigjs">
    <button type="button" class="btn btn-outline-secondary" id="LineClickedHidden" data-toggle="modal" data-target="#myModalLine" style="display:none"></button>
    <button type="button" class="btn btn-outline-secondary" id="bzClickedHidden" data-toggle="modal" data-target="#myModalBZ" style="display:none"></button>
    <button type="button" class="btn btn-outline-secondary" id="sinClickedHidden" data-toggle="modal" data-target="#myModalSin" style="display:none"></button>
    <button type="button" class="btn btn-outline-secondary" id="chinClickedHidden" data-toggle="modal" data-target="#myModalchin" style="display:none"></button>
    <button type="button" class="btn btn-outline-secondary" id="arcClickedHidden" data-toggle="modal" data-target="#myModalarc" style="display:none"></button>

    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel" style="font-family:'B Yekan'">تنظیمات</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">میزان حرکت صفحه با پن</label>
                        <input type="text" class="form-control" id="panvalue" value="1">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">مستطیل شکل انتخاب شده</label>
                        <input type="text" class="form-control" id="drawboundingrect" value="1">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">اعداد خط کش</label>
                        <input type="text" class="form-control" id="drawgridtext" value="1">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">نمایش خط راهنما</label>
                        <input type="text" class="form-control" id="drawgrid" value="1">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">نام فایل ذخیره</label>
                        <input type="text" class="form-control" id="saveasfilenameInput" value="File">

                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" style="font-family:'B Yekan'" onclick="closepathok()">بستن مسیر</button>
                    <button type="button" class="btn btn-primary" style="font-family:'B Yekan'" onclick="closepathiok()"> iبستن مسیر</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" style="font-family:'B Yekan'">بستن</button>
                    <button type="button" class="btn btn-primary" style="font-family:'B Yekan'" onclick="settingsok()">تایید</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel" style="font-family:'B Yekan'">عملکرد اسلایدر</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="font-family:'B Yekan'">
                    <div class="form-group" style="font-family:'B Yekan'">
                        <select class="form-control" id="sel1">
                            <option style="font-family:'B Yekan'">ارتفاع بوم</option>
                            <option style="font-family:'B Yekan'">بزرگ کردن عکس</option>
                            <option style="font-family:'B Yekan'">محو عکس</option>
                            <option style="font-family:'B Yekan'">جابجایی افقی عکس</option>
                            <option style="font-family:'B Yekan'">جابجایی عمودی عکس</option>
                        </select>

                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">ضریب</label>
                        <input type="text" class="form-control" id="sliderscale" value="1">

                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" style="font-family:'B Yekan'">بستن</button>
                    <button type="button" class="btn btn-primary" style="font-family:'B Yekan'" onclick="slidersettingsok()">تایید</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="myModalLine" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content" style="background-color: rgba(255, 255, 255, .1)">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel" style="font-family:'B Yekan'">خط</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="font-family:'B Yekan'">
                    <div class="form-group" style="font-family:'B Yekan'">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">عرض</label>
                        <input type="text" class="form-control" id="lineWidthInput" value="">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="lineWidthInputRange" oninput="lineWidthInputchange()">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">ارتفاع</label>
                        <input type="text" class="form-control" id="lineHeightInput" value="">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="lineHeightInputRange" oninput="lineHeightInputchange()">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="newlinebtn()" style="font-family:'B Yekan'">خط جدید</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" style="font-family:'B Yekan'">بستن</button>
                    <button type="button" class="btn btn-primary" style="font-family:'B Yekan'" onclick="lineok()">تایید</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="myModalBZ" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content" style="background-color: rgba(255, 255, 255, .1)">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel" style="font-family:'B Yekan'">بازیر</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="font-family:'B Yekan'">
                    <div class="form-group" style="font-family:'B Yekan'">
                        <select class="form-control" id="selbz">
                            <option style="font-family:'B Yekan'">نقطه پایانی</option>
                            <option style="font-family:'B Yekan'">نقطه کنترل 1</option>
                            <option style="font-family:'B Yekan'">نقطه کنترل 2</option>
                        </select>

                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">عرض</label>
                        <input type="text" class="form-control" id="bzWidthInput" value="10">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="bzWidthInputRange" oninput="bzWidthInputchange()">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">ارتفاع</label>
                        <input type="text" class="form-control" id="bzHeightInput" value="10">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="bzHeightInputRange" oninput="bzHeightInputchange()">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="newbzbtn()" style="font-family:'B Yekan'">منحنی جدید</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" style="font-family:'B Yekan'">بستن</button>
                    <button type="button" class="btn btn-primary" style="font-family:'B Yekan'" onclick="bzok()">تایید</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="myModalSin" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content" style="background-color: rgba(255, 255, 255, .1)">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel" style="font-family:'B Yekan'">موج</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="font-family:'B Yekan'">
                    <div class="form-group" style="font-family:'B Yekan'">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">طول قله تا قله</label>
                        <input type="text" class="form-control" id="sinWidthInput" value="10">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="sinWidthInputRange" oninput="sinWidthInputchange()">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">ارتفاع</label>
                        <input type="text" class="form-control" id="sinHeightInput" value="2">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="sinHeightInputRange" oninput="sinHeightInputchange()">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">تعداد قله ها</label>
                        <input type="text" class="form-control" id="sinNInput" value="6">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="sinNInputRange" oninput="sinNInputchange()">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">زاویه</label>
                        <input type="text" class="form-control" id="sinAngleInput" value="0">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="sinAngleInputRange" oninput="sinAngleInputchange()">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">زاویه شروع</label>
                        <input type="text" class="form-control" id="sinstartAngleInput" value="0">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="sinstartAngleInputRange" oninput="sinstartAngleInputchange()">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="newsinbtn()" style="font-family:'B Yekan'">موج جدید</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" style="font-family:'B Yekan'">بستن</button>
                    <button type="button" class="btn btn-primary" style="font-family:'B Yekan'" onclick="sinok()">تایید</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="myModalchin" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content" style="background-color: rgba(255, 255, 255, .1)">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel" style="font-family:'B Yekan'">چین</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="font-family:'B Yekan'">
                    <div class="form-group" style="font-family:'B Yekan'">

                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">فعال کردن</label>
                        <input type="text" class="form-control" id="chinenableInput" value="-1">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="chinenableInputRange" oninput="chinenableInputchange()">

                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">فاصله ابتدای کار</label>
                        <input type="text" class="form-control" id="chinbiasInput" value="3">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="chinbiasInputRange" oninput="chinbiasInputchange()">

                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">عرض چین</label>
                        <input type="text" class="form-control" id="chinWidthInput" value=".5">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="chinWidthInputRange" oninput="chinWidthInputchange()">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">ارتفاع چین</label>
                        <input type="text" class="form-control" id="chinHeightInput" value=".5">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="chinHeightInputRange" oninput="chinHeightInputchange()">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">فاصله میان چین ها</label>
                        <input type="text" class="form-control" id="chinLInput" value="1">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="chinLInputRange" oninput="chinLInputchange()">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">حداکثر تعداد چین ها</label>
                        <input type="text" class="form-control" id="chinMaxInput" value="1000">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="chinMaxInputRange" oninput="chinMaxInputchange()">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">جهت چین</label>
                        <input type="text" class="form-control" id="chindirInput" value="1">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="chindirInputRange" oninput="chindirInputchange()">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" style="font-family:'B Yekan'">بستن</button>
                    <button type="button" class="btn btn-primary" style="font-family:'B Yekan'" onclick="chinok()">تایید</button>
                </div>
            </div>
        </div>
    </div>



    
    <div class="modal fade" id="myModalarc" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content" style="background-color: rgba(255, 255, 255, .1)">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel" style="font-family:'B Yekan'">کمان</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="font-family:'B Yekan'">
                    <div class="form-group" style="font-family:'B Yekan'">

                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">زاویه شروع</label>
                        <input type="text" class="form-control" id="arcstartangle" value="0">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="arcstartangleRange" oninput="arcstartanglechange()">

                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">مقدار کمان</label>
                        <input type="text" class="form-control" id="arcLengthInput" value="270">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="arcLengthInputRange" oninput="arcLengthInputchange()">

                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">قطر کمان</label>
                        <input type="text" class="form-control" id="arcDiameterInput" value="30">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="arcDiameterInputRange" oninput="arcDiameterInputchange()">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">جهت</label>
                        <input type="text" class="form-control" id="arcDirectionInput" value="1">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="arcDirectionInputRange" oninput="arcDirectionInputchange()">
                        <label for="recipient-name" class="col-form-label" style="font-family:'B Yekan'">کاهش قطر بر دور</label>
                        <input type="text" class="form-control" id="arcDecayInput" value="0">
                        <input type="range" width="100%" min="1" max="100" value="50" class="slider" id="arcDecayInputRange" oninput="arcDecayInputchange()">
                        
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="newarcbtn()" style="font-family:'B Yekan'">کمان جدید</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" style="font-family:'B Yekan'">بستن</button>
                    <button type="button" class="btn btn-primary" style="font-family:'B Yekan'" onclick="arcok()">تایید</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        function norm(p0, p1) {
            return Math.sqrt((p1[0] - p0[0]) * (p1[0] - p0[0]) + (p1[1] - p0[1]) * (p1[1] - p0[1]))
        }
        function normxy(p0, p1) {
            return Math.sqrt((p1.x - p0.x) * (p1.x - p0.x) + (p1.y - p0.y) * (p1.y - p0.y))
        }
        function moveDistanceDirection(Point, d, a) {
            return [Point[0] + d * Math.cos(a), Point[1] + d * Math.sin(a)]
        }
        class Scenario {
            constructor(Num) {
                this.Number = Num
                this.shapes = []
            }
        }
        class Dispay {
            constructor() {
                this.bias = [-50, 50]
                this.scale = 5
                this.bias_image = [0, 0]
                this.scale_image = .1
                this.opavity_image = .2
                this.mousePressed = 0
                this.loaded_image = 0
                this.grid_xy = [10, 10]
            }
            xy2pixel(xy) {
                return [(xy[0] - this.bias[0]) * this.scale, -(xy[1] - this.bias[1]) * this.scale]
            }
            pixel2xy(pixel) {
                return [pixel[0] / this.scale + this.bias[0], -pixel[1] / this.scale + this.bias[1]]
            }
            pixel2xyLen(pixel) {
                return [pixel[0] / this.scale, pixel[1] / this.scale]
            }
        }
        snr = new Scenario(1)
        dsp = new Dispay()
        function lineok() {
            var pp = getStartPoint(currentIndex)
            snr.shapes[currentIndex][1] = pp[0] + parseFloat(document.getElementById('lineWidthInput').value)
            snr.shapes[currentIndex][2] = pp[1] + parseFloat(document.getElementById('lineHeightInput').value)
            repaint()
        }
        function lineHeightInputchange() {
            document.getElementById('lineHeightInput').value = (document.getElementById('lineHeightInputRange').value - 50) * sliderOptionScaler
            lineok()
        }
        function lineWidthInputchange() {
            document.getElementById('lineWidthInput').value = (document.getElementById('lineWidthInputRange').value - 50) * sliderOptionScaler
            lineok()
        }
        function newlinebtn() {
            currentIndex = snr.shapes.length
            var pp = getStartPoint(currentIndex)
            snr.shapes.push([1, pp[0] + parseFloat(document.getElementById('lineWidthInput').value), pp[1] + parseFloat(document.getElementById('lineHeightInput').value), 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
            currentIndex = snr.shapes.length - 1
            repaint()
        }
        function chinok() {
            if (currentIndex < 0) return
            if (currentIndex >= snr.shapes.length) return
            snr.shapes[currentIndex][11] = parseInt(document.getElementById('chinenableInput').value)
            snr.shapes[currentIndex][12] = parseFloat(document.getElementById('chinbiasInput').value)
            snr.shapes[currentIndex][13] = parseFloat(document.getElementById('chinWidthInput').value)
            snr.shapes[currentIndex][14] = parseFloat(document.getElementById('chinHeightInput').value)
            snr.shapes[currentIndex][15] = parseFloat(document.getElementById('chinLInput').value)
            snr.shapes[currentIndex][16] = parseFloat(document.getElementById('chinMaxInput').value)
            snr.shapes[currentIndex][17] = parseFloat(document.getElementById('chindirInput').value)
            repaint()
        }
        function chinenableInputchange() {
            document.getElementById('chinenableInput').value = 0
            if ((document.getElementById('chinenableInputRange').value) > 50) document.getElementById('chinenableInput').value = 1
            chinok()
        }
        function chinbiasInputchange() {
            document.getElementById('chinbiasInput').value = (document.getElementById('chinbiasInputRange').value) / 5 * sliderOptionScaler
            chinok()
        }
        function chinWidthInputchange() {
            document.getElementById('chinWidthInput').value = (document.getElementById('chinWidthInputRange').value) / 5 * sliderOptionScaler
            chinok()
        }
        function chinHeightInputchange() {
            document.getElementById('chinHeightInput').value = (document.getElementById('chinHeightInputRange').value) / 5 * sliderOptionScaler
            chinok()
        }
        function chinLInputchange() {
            document.getElementById('chinLInput').value = (document.getElementById('chinLInputRange').value) / 5 * sliderOptionScaler
            chinok()
        }
        function chinMaxInputchange() {
            document.getElementById('chinMaxInput').value = (document.getElementById('chinMaxInputRange').value) / 5 * sliderOptionScaler
            chinok()
        }
        function chindirInputchange() {
            document.getElementById('chindirInput').value = -1
            if (document.getElementById('chindirInputRange').value > 50) document.getElementById('chindirInput').value = 1
            chinok()
        }
        function rot(x, y, t) {
            return [x * Math.cos(t) - y * Math.sin(t), x * Math.sin(t) + y * Math.cos(t)]
        }
        function newarcbtn() {
            currentIndex = snr.shapes.length
            var pp = getStartPoint(currentIndex)
            var t0=parseFloat(document.getElementById('arcstartangle').value)
            var tL=parseFloat(document.getElementById('arcLengthInput').value)
            var R=parseFloat(document.getElementById('arcDiameterInput').value)
            var D=parseFloat(document.getElementById('arcDirectionInput').value)
            var eps=parseFloat(document.getElementById('arcDecayInput').value)
            
            var xy=[(R/2-eps*0/360)*Math.cos((t0+D*0)/180*Math.PI),(R/2-eps*0/360)*Math.sin((t0+D*0)/180*Math.PI)]
                    pp[0]-=xy[0]
                    pp[1]-=xy[1]
            xy=[(R/2-eps*tL/360)*Math.cos((t0+D*tL)/180*Math.PI),(R/2-eps*tL/360)*Math.sin((t0+D*tL)/180*Math.PI)]
            snr.shapes.push([3, pp[0] + xy[0], pp[1] + xy[1], t0, tL, R, D, eps, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
            currentIndex = snr.shapes.length - 1
            repaint()
        }
        function arcok() {
            var pp = getStartPoint(currentIndex)
            var t0=parseFloat(document.getElementById('arcstartangle').value)
            var tL=parseFloat(document.getElementById('arcLengthInput').value)
            var R=parseFloat(document.getElementById('arcDiameterInput').value)
            var D=parseFloat(document.getElementById('arcDirectionInput').value)
            var eps=parseFloat(document.getElementById('arcDecayInput').value)
            var xy=[(R/2-eps*0/360)*Math.cos((t0+D*0)/180*Math.PI),(R/2-eps*0/360)*Math.sin((t0+D*0)/180*Math.PI)]
                    pp[0]-=xy[0]
                    pp[1]-=xy[1]
            xy=[(R/2-eps*tL/360)*Math.cos((t0+D*tL)/180*Math.PI),(R/2-eps*tL/360)*Math.sin((t0+D*tL)/180*Math.PI)]
            snr.shapes[currentIndex][1]= pp[0] + xy[0]
            snr.shapes[currentIndex][2]= pp[1] + xy[1]
            snr.shapes[currentIndex][3]= t0
            snr.shapes[currentIndex][4]= tL
            snr.shapes[currentIndex][5]= R
            snr.shapes[currentIndex][6]= D
            snr.shapes[currentIndex][7]= eps
            repaint()
        }
        function arcstartanglechange() {
            document.getElementById('arcstartangle').value = (document.getElementById('arcstartangleRange').value - 1) / 99 * 360
            arcok()
        }
        
        function arcLengthInputchange() {
            document.getElementById('arcLengthInput').value = (document.getElementById('arcLengthInputRange').value - 1) / 99 * 360
            arcok()
        }
        
        function arcDiameterInputchange() {
            document.getElementById('arcDiameterInput').value = (document.getElementById('arcDiameterInputRange').value - 1) 
            arcok()
        }
        function arcDirectionInputchange() {
            if((document.getElementById('arcDirectionInputRange').value>50))document.getElementById('arcDirectionInput').value = 1
            else document.getElementById('arcDirectionInput').value = -1
            arcok()
        }
        
        function arcDecayInputchange() {
            document.getElementById('arcDecayInput').value = Math.round((document.getElementById('arcDecayInputRange').value - 1) /9.9)/10
            arcok()
        }
        function newsinbtn() {
            currentIndex = snr.shapes.length
            var pp = getStartPoint(currentIndex)
            var d = parseFloat(document.getElementById('sinWidthInput').value)
            var N = parseFloat(document.getElementById('sinNInput').value)
            var H = parseFloat(document.getElementById('sinHeightInput').value)
            var t = Math.PI * parseFloat(document.getElementById('sinAngleInput').value) / 180
            var st = Math.PI * parseFloat(document.getElementById('sinstartAngleInput').value) / 180
            
            var xy = rot(0, H * Math.sin(st), t)
                    pp[0]-=xy[0]
                    pp[1]-=xy[1]
            var x = N * d
            var y = H * Math.sin(2 * Math.PI * x / d + st)
            var xy = rot(x, y, t)
            snr.shapes.push([5, pp[0] + xy[0], pp[1] + xy[1], N, d, H, t, st, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
            currentIndex = snr.shapes.length - 1
            repaint()
        }
        function sinok() {
            var pp = getStartPoint(currentIndex)
            var d = parseFloat(document.getElementById('sinWidthInput').value)
            var N = parseFloat(document.getElementById('sinNInput').value)
            var H = parseFloat(document.getElementById('sinHeightInput').value)
            var t = Math.PI * parseFloat(document.getElementById('sinAngleInput').value) / 180
            var st = Math.PI * parseFloat(document.getElementById('sinstartAngleInput').value) / 180
            
            var xy = rot(0, H * Math.sin(st), t)
                    pp[0]-=xy[0]
                    pp[1]-=xy[1]
            var x = N * d
            var y = H * Math.sin(2 * Math.PI * x / d + st)
            var xy = rot(x, y, t)
            snr.shapes[currentIndex] = [5, pp[0] + xy[0], pp[1] + xy[1], N, d, H, t, st, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
            repaint()
        }
        function sinAngleInputchange() {
            document.getElementById('sinAngleInput').value = (document.getElementById('sinAngleInputRange').value - 1) / 99 * 360
            sinok()
        }
        
        function sinstartAngleInputchange() {
            document.getElementById('sinstartAngleInput').value = (document.getElementById('sinstartAngleInputRange').value - 1) / 99 * 360
            sinok()
        }
        function sinNInputchange() {
            document.getElementById('sinNInput').value = (document.getElementById('sinNInputRange').value) / 5 * sliderOptionScaler
            sinok()
        }
        function sinWidthInputchange() {
            document.getElementById('sinWidthInput').value = (document.getElementById('sinWidthInputRange').value) / 5 * sliderOptionScaler
            sinok()
        }
        function sinHeightInputchange() {
            document.getElementById('sinHeightInput').value = (document.getElementById('sinHeightInputRange').value) / 5 * sliderOptionScaler
            sinok()
        }
        function bzok() {
            var pp = getStartPoint(currentIndex)
            bzp = document.getElementById('selbz').selectedIndex
            snr.shapes[currentIndex][1 + 2 * bzp] = pp[0] + parseFloat(document.getElementById('bzWidthInput').value)
            snr.shapes[currentIndex][2 + 2 * bzp] = pp[1] + parseFloat(document.getElementById('bzHeightInput').value)
            repaint()
        }
        function bzHeightInputchange() {
            document.getElementById('bzHeightInput').value = (document.getElementById('bzHeightInputRange').value - 50) * sliderOptionScaler
            bzok()
        }
        function bzWidthInputchange() {
            document.getElementById('bzWidthInput').value = (document.getElementById('bzWidthInputRange').value - 50) * sliderOptionScaler
            bzok()
        }
        function newbzbtn() {
            currentIndex = snr.shapes.length
            var pp = getStartPoint(currentIndex)
            snr.shapes.push([4, pp[0] + parseFloat(document.getElementById('bzWidthInput').value), pp[1] + parseFloat(document.getElementById('bzHeightInput').value), 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
            currentIndex = snr.shapes.length - 1
            repaint()
        }
        var sliderOption = 0
        var sliderOptionScaler = 1
        function slidersettingsok() {
            sliderOption = document.getElementById('sel1').selectedIndex
            sliderOptionScaler = parseFloat($("#sliderscale").val())
        }
        function btnselback() {
            currentIndex -= 1
            if (currentIndex < 0) currentIndex = -1
            repaint()
        }
        function btnselfw() {
            currentIndex += 1
            if (currentIndex >= snr.shapes.length) currentIndex = snr.shapes.length
            repaint()
        }
        function closepathok() {
            if (snr.shapes.length > 1) {
                s = getStartPoint(0)
                snr.shapes[snr.shapes.length - 1][1] = s[0]
                snr.shapes[snr.shapes.length - 1][2] = s[1]
                repaint()
            }
        }
        function closepathiok() {
            if (snr.shapes.length > 1) {
                //if(currentIndex!=snr.shapes.length-1)
                s = getStartPoint(currentIndex)
                snr.shapes[snr.shapes.length - 1][1] = s[0]
                snr.shapes[snr.shapes.length - 1][2] = s[1]
                repaint()
            }
        }
        var isdrawboundingrect = 1
        var isdrawgridtext = 1
        var isdrawgrid = 1
        function settingsok() {
            movePanParameter = parseFloat($("#panvalue").val())
            isdrawboundingrect = parseFloat($("#drawboundingrect").val())
            isdrawgridtext = parseFloat($("#drawgridtext").val())
            isdrawgrid = parseFloat($("#drawgrid").val())
            saveasfilename = $("#saveasfilenameInput").val()
            repaint()
        }
        function rangechange() {
            if (sliderOption == 0) {
                c.height = 100 + sliderOptionScaler * 10 * parseFloat($("#myRange").val())
            }
            if (sliderOption == 1) {
                dsp.scale_image = sliderOptionScaler * parseFloat($("#myRange").val()) / 30
            }
            if (sliderOption == 2) {
                dsp.opavity_image = parseFloat($("#myRange").val()) / 100
            }
            if (sliderOption == 3) {
                dsp.bias_image[0] = sliderOptionScaler * 50 * (parseFloat($("#myRange").val()) - 50) / 50
            }
            if (sliderOption == 4) {
                dsp.bias_image[1] = sliderOptionScaler * 50 * (parseFloat($("#myRange").val()) - 50) / 50
            }
            repaint()
        }
        function linecheck(N) {}
        $(document).ready(function() {
            c.width = document.getElementById('canvcont').clientWidth
            c.height = document.documentElement.clientHeight * .8
            repaint()
        });
        var currentIndex = 0
        function repaint() {
            var ctx = c.getContext("2d");
            ctx.beginPath();
            ctx.clearRect(0, 0, c.width, c.height);
            if (dsp.loaded_image == 1) {
                ctx.globalAlpha = dsp.opavity_image
                ctx.drawImage(img, dsp.bias_image[0], dsp.bias_image[1], dsp.scale_image * img.width, dsp.scale_image * img.height);
                ctx.globalAlpha = 1
            }
            if (isdrawgrid) {
                ctx.strokeStyle = 'rgba(0,0,0,0.2)'
                for (var i = -10; i <= 10; i++) {
                    var p0 = dsp.xy2pixel([i * 10, -100])
                    var p1 = dsp.xy2pixel([i * 10, 100])
                    var p2 = dsp.xy2pixel([i * 10, 0])
                    ctx.moveTo(p0[0], p0[1])
                    ctx.lineTo(p1[0], p1[1])
                    if (isdrawgridtext) {
                        ctx.fillText(i * 10, p2[0], p2[1]);
                    }
                }
                for (var i = -10; i <= 10; i++) {
                    var p0 = dsp.xy2pixel([-100, i * 10])
                    var p1 = dsp.xy2pixel([100, i * 10])
                    var p2 = dsp.xy2pixel([0, i * 10])
                    ctx.moveTo(p0[0], p0[1])
                    ctx.lineTo(p1[0], p1[1])
                    if (isdrawgridtext) {
                        ctx.fillText(i * 10, p2[0], p2[1])
                    }
                }
                ctx.stroke();
            }
            var startPointxy = [0, 0]
            var startPoint = dsp.xy2pixel(startPointxy)
            //comment.innerHTML = snr.shapes.length
            var startAngs = []
            var endAngs = []
            allpoints = []
            for (var iijj = 0; iijj < snr.shapes.length; iijj++) {
                ctx.beginPath();
                if (iijj == currentIndex) {
                    ctx.strokeStyle = 'rgba(255,0,0,1)'
                } else {
                    ctx.strokeStyle = 'rgba(0,0,0,1)'
                }
                ctx.moveTo(startPoint[0], startPoint[1]);
                allpoints.push(dsp.pixel2xy(startPoint))
                var startPoint_ = startPoint
                var onepath = snr.shapes[iijj];
                if (onepath[0] == 1) {
                    var w, h;
                    var startPointxy_ = startPointxy
                    startPointxy = [onepath[1], onepath[2]]
                    startPoint = dsp.xy2pixel(startPointxy)
                    var ang0 = Math.atan2(startPointxy[1] - startPointxy_[1], startPointxy[0] - startPointxy_[0])
                    startAngs.push(ang0)
                    endAngs.push(ang0)
                    var allPathDis = norm(startPointxy_, startPointxy)
                    var allPathDisnow = 0
                    if (onepath[11]) {
                        var bias_Q = onepath[12]
                        var W_Q = onepath[13]
                        var WF_Q = onepath[15]
                        var H_Q = onepath[14]
                        var N_Q = onepath[16]
                        var d_Q = onepath[17]
                        var N_Qi = 0
                        var QP = moveDistanceDirection(startPointxy_, bias_Q, ang0)
                        allPathDisnow += bias_Q
                        while (1) {
                            if (allPathDisnow >= allPathDis) break
                            N_Qi += 1
                            if (N_Qi > N_Q) break
                            var wh = dsp.xy2pixel(QP)
                            allpoints.push(QP)
                            ctx.lineTo(wh[0], wh[1])
                            allPathDisnow += W_Q
                            if (allPathDisnow >= allPathDis) break
                            var QP1 = moveDistanceDirection(QP, H_Q, ang0 + d_Q * Math.PI / 2)
                            wh = dsp.xy2pixel(QP1)
                            allpoints.push(QP1)
                            ctx.lineTo(wh[0], wh[1])
                            var QP2 = moveDistanceDirection(QP1, W_Q, ang0)
                            wh = dsp.xy2pixel(QP2)
                            allpoints.push(QP2)
                            ctx.lineTo(wh[0], wh[1])
                            QP1 = moveDistanceDirection(QP2, H_Q, ang0 - d_Q * Math.PI / 2)
                            wh = dsp.xy2pixel(QP1)
                            allpoints.push(QP1)
                            ctx.lineTo(wh[0], wh[1])
                            allPathDisnow += WF_Q
                            if (allPathDisnow >= allPathDis) break
                            QP = moveDistanceDirection(QP1, WF_Q, ang0)
                            wh = dsp.xy2pixel(QP)
                            allpoints.push(QP)
                            ctx.lineTo(wh[0], wh[1])
                        }
                    }
                    allpoints.push(dsp.pixel2xy(startPoint))
                    ctx.lineTo(startPoint[0], startPoint[1])
                }
                if (onepath[0] == 4) {
                    p0 = {
                        x: startPointxy[0],
                        y: startPointxy[1]
                    }
                    p3 = {
                        x: onepath[1],
                        y: onepath[2]
                    }
                    p2 = {
                        x: onepath[3],
                        y: onepath[4]
                    }
                    p1 = {
                        x: onepath[5],
                        y: onepath[6]
                    }
                    var pb
                    var allPathDis = 0
                    for (var i = 0; i <= 100; i += 1) {
                        var p = bezier(i / 100, p0, p1, p2, p3);
                        if (i == 0) pb = p
                        else allPathDis += normxy(p, pb)
                        if (i == 1) startAngs.push(Math.atan2(p.y - pb.y, p.x - pb.x))
                        if (i == 99) pb = p
                        if (i == 100) endAngs.push(Math.atan2(p.y - pb.y, p.x - pb.x))
                    }
                    if (onepath[11] == 1) {
                        var allPathDisnow = 0
                        var bzparanorm = 0
                        var bzstep = 1 / 100
                        var bzstep2 = 1 / 1000
                        var bias_Q = onepath[12]
                        var W_Q = onepath[13]
                        var WF_Q = onepath[15]
                        var H_Q = onepath[14]
                        var N_Q = onepath[16]
                        var d_Q = onepath[17]
                        var N_Qi = 0
                        var ii = 0
                        var ppp = {
                            x: startPointxy[0],
                            y: startPointxy[1]
                        }
                        while (bzparanorm <= 1) {
                            bzparanorm += bzstep
                            if (bzparanorm >= 1) break;
                            var p = bezier(bzparanorm, p0, p1, p2, p3);
                            allPathDisnow += normxy(ppp, p)
                            ppp = p
                            var wh = dsp.xy2pixel([p.x, p.y])
                            allpoints.push([p.x, p.y])
                            w = wh[0]
                            h = wh[1]
                            ctx.lineTo(w, h)
                            if (allPathDisnow >= bias_Q) break
                        }
                        while (bzparanorm <= 1) {
                            var disnow = 0
                            var pre = bzparanorm
                            ppp = bezier(bzparanorm, p0, p1, p2, p3)
                            while (disnow < W_Q) {
                                bzparanorm += bzstep2
                                if (bzparanorm >= 1) break;
                                var p = bezier(bzparanorm, p0, p1, p2, p3);
                                disnow += normxy(ppp, p)
                                ppp = p
                            }
                            q0 = bezier(pre, p0, p1, p2, p3)
                            q01 = bezier(pre + 1 / 1000, p0, p1, p2, p3)
                            t0 = Math.atan2(q01.y - q0.y, q01.x - q0.x)
                            var QP1 = moveDistanceDirection([q0.x, q0.y], H_Q, t0 + d_Q * Math.PI / 2)
                            wh = dsp.xy2pixel(QP1)
                            allpoints.push(QP1)
                            ctx.lineTo(wh[0], wh[1])
                            q0 = bezier(bzparanorm - .001, p0, p1, p2, p3)
                            q01 = bezier(bzparanorm, p0, p1, p2, p3)
                            t0 = Math.atan2(q01.y - q0.y, q01.x - q0.x)
                            QP1 = moveDistanceDirection([p.x, p.y], H_Q, t0 + d_Q * Math.PI / 2)
                            wh = dsp.xy2pixel(QP1)
                            allpoints.push(QP1)
                            ctx.lineTo(wh[0], wh[1])
                            var wh = dsp.xy2pixel([p.x, p.y])
                            allpoints.push([p.x, p.y])
                            ctx.lineTo(wh[0], wh[1])
                            disnow = 0
                            ppp = bezier(bzparanorm, p0, p1, p2, p3);
                            while (bzparanorm < 1) {
                                bzparanorm += bzstep
                                if (bzparanorm >= 1) break;
                                var p = bezier(bzparanorm, p0, p1, p2, p3);
                                disnow += normxy(ppp, p)
                                ppp = p
                                var wh = dsp.xy2pixel([p.x, p.y])
                                w = wh[0]
                                h = wh[1]
                                allpoints.push([p.x, p.y])
                                ctx.lineTo(w, h)
                                if (disnow >= WF_Q) break
                            }
                            N_Qi += 1
                            if (N_Qi >= N_Q) {
                                while (bzparanorm < 1) {
                                    bzparanorm += bzstep
                                    if (bzparanorm >= 1) break;
                                    var p = bezier(bzparanorm, p0, p1, p2, p3);
                                    disnow += normxy(ppp, p)
                                    ppp = p
                                    var wh = dsp.xy2pixel([p.x, p.y])
                                    w = wh[0]
                                    h = wh[1]
                                    allpoints.push([p.x, p.y])
                                    ctx.lineTo(w, h)
                                }
                            }
                        }
                        startPointxy = [onepath[1], onepath[2]]
                        wh = dsp.xy2pixel(startPointxy)
                        allpoints.push(startPointxy)
                        ctx.lineTo(wh[0], wh[1])
                    } else {
                        for (var i = 0; i <= 100; i += 1) {
                            var p = bezier(i / 100, p0, p1, p2, p3);
                            var wh = dsp.xy2pixel([p.x, p.y])
                            w = wh[0];
                            h = wh[1];
                            allpoints.push([p.x, p.y])
                            ctx.lineTo(w, h);
                        }
                    }
                    startPointxy = [onepath[1], onepath[2]]
                    startPoint = dsp.xy2pixel(startPointxy)
                }
                if (onepath[0] == 5) {
                    startPointxy = [onepath[1], onepath[2]]
                    startPoint = dsp.xy2pixel(startPointxy)
                    var pp = getStartPoint(iijj)
                    var st = onepath[7]
                    var N = onepath[3]
                    var d = onepath[4]
                    var H = onepath[5]
                    var t = onepath[6]
                    var xy = rot(0, H * Math.sin(st), t)
                    pp[0]-=xy[0]
                    pp[1]-=xy[1]
                    var x = N * d
                    var dx = 0
                    var res = .1
                    if (onepath[11] == 1) {
                        var bias_Q = onepath[12]
                        var W_Q = onepath[13]
                        var WF_Q = onepath[15]
                        var H_Q = onepath[14]
                        var N_Q = onepath[16]
                        var d_Q = onepath[17]
                        var N_Qi = 0
                        allPathDisnow = 0
                        while (dx <= x) {
                            var p = [dx, H * Math.sin(2 * Math.PI * dx / d + st)]
                            var ppp = [dx,H * Math.sin(2 * Math.PI * (dx - res) / d + st)]
                            allPathDisnow += norm(ppp, p)
                            var xy = rot(p[0], p[1], t)
                            xy[0] += pp[0]
                            xy[1] += pp[1]
                            var wh = dsp.xy2pixel(xy)
                            allpoints.push(xy)
                            w = wh[0]
                            h = wh[1]
                            ctx.lineTo(w, h)
                            if (allPathDisnow >= bias_Q) break
                            dx+=res
                        }
                        while (dx <= x) {
                            q0 = [dx-.01,H * Math.sin(2 * Math.PI * (dx - .01) / d + st)]
                            q01 = [dx,H * Math.sin(2 * Math.PI * dx / d + st)]
                            t0 = Math.atan2(q01[1] - q0[1], q01[0] - q0[0])
                            var QP1 = moveDistanceDirection(q0, H_Q, t0 + d_Q * Math.PI / 2)
                            var xy = rot(QP1[0], QP1[1], t)
                            xy[0] += pp[0]
                            xy[1] += pp[1]
                            var wh = dsp.xy2pixel(xy)
                            allpoints.push(xy)
                            w = wh[0]
                            h = wh[1]
                            ctx.lineTo(w, h)
                            var disnow = 0
                            while (disnow < W_Q) {
                                dx += .01
                                if (dx >= x) break;
                                disnow += norm([dx,H * Math.sin(2 * Math.PI * dx / d + st)], [dx-.01,H * Math.sin(2 * Math.PI * (dx - .01) / d + st)])
                            }
                            
                            q0 = [dx-.01,H * Math.sin(2 * Math.PI * (dx - .01) / d + st)]
                            q01 = [dx,H * Math.sin(2 * Math.PI * dx / d + st)]
                            t0 = Math.atan2(q01[1] - q0[1], q01[0] - q0[0])
                            QP1 = moveDistanceDirection(q0, H_Q, t0 + d_Q * Math.PI / 2)
                            xy = rot(QP1[0], QP1[1], t)
                            xy[0] += pp[0]
                            xy[1] += pp[1]
                            var wh = dsp.xy2pixel(xy)
                            allpoints.push(xy)
                            w = wh[0]
                            h = wh[1]
                            ctx.lineTo(w, h)
                            xy = rot(q0[0], q0[1], t)
                            xy[0] += pp[0]
                            xy[1] += pp[1]
                            var wh = dsp.xy2pixel(xy)
                            allpoints.push(xy)
                            w = wh[0]
                            h = wh[1]
                            ctx.lineTo(w, h)
                            disnow = 0
                            while (disnow < WF_Q) {
                                dx += .1
                                if (dx >= x) break;
                                disnow += norm([dx,H * Math.sin(2 * Math.PI * dx / d + st)],[dx-.1, H * Math.sin(2 * Math.PI * (dx - .1) / d + st)])
                                QP1 = [dx,H * Math.sin(2 * Math.PI * dx / d + st)]
                                xy = rot(QP1[0], QP1[1], t)
                                xy[0] += pp[0]
                                xy[1] += pp[1]
                                var wh = dsp.xy2pixel(xy)
                                allpoints.push(xy)
                                w = wh[0]
                                h = wh[1]
                                ctx.lineTo(w, h)
                            }
                            N_Qi += 1
                            if (N_Qi >= N_Q) {
                                while (1) {
                                    dx += .1
                                    if (dx >= x) break;
                                    disnow += norm([dx,H * Math.sin(2 * Math.PI * dx / d + st)],[dx-.1, H * Math.sin(2 * Math.PI * (dx - .1) / d + st)])
                                    QP1 = [dx,H * Math.sin(2 * Math.PI * dx / d + st)]
                                    xy = rot(QP1[0], QP1[1], t)
                                    xy[0] += pp[0]
                                    xy[1] += pp[1]
                                    var wh = dsp.xy2pixel(xy)
                                    allpoints.push(xy)
                                    w = wh[0]
                                    h = wh[1]
                                    ctx.lineTo(w, h)
                                }
                            }
                        }
                    } else {
                        while (dx <= x) {
                            var y = H * Math.sin(2 * Math.PI * dx / d + st)
                            var xy = rot(dx, y, t)
                            xy[0] += pp[0]
                            xy[1] += pp[1]
                            wh = dsp.xy2pixel(xy)
                            allpoints.push(xy)
                            ctx.lineTo(wh[0], wh[1])
                            dx += res
                        }
                    }
                    ctx.lineTo(startPoint[0], startPoint[1])
                }
               
               
               if (onepath[0] == 3) {
                    startPointxy = [onepath[1], onepath[2]]
                    startPoint = dsp.xy2pixel(startPointxy)
                    var pp = getStartPoint(iijj)
                    var t0=onepath[3]
                    var tL0=onepath[4]
                    var R=onepath[5]
                    var D=onepath[6]
                    var eps=onepath[7]
                    var tL=0
                    var tLres=.1/(R*Math.PI)*360
                    var xy=arcPoint(t0,R,eps,tL,D)
                    pp[0]-=xy[0]
                    pp[1]-=xy[1]
                    if (onepath[11] == 1) {
                        var bias_Q = onepath[12]
                        var W_Q = onepath[13]
                        var WF_Q = onepath[15]
                        var H_Q = onepath[14]
                        var N_Q = onepath[16]
                        var d_Q = onepath[17]
                        var N_Qi = 0
                        allPathDisnow = 0
                        while (tL <= tL0) {
                            var xy = arcPoint(t0,R,eps,tL,D)
                            var ppp = arcPoint(t0,R,eps,tL-tLres,D)
                            allPathDisnow += norm(ppp, xy)
                            xy[0] += pp[0]
                            xy[1] += pp[1]
                            wh = dsp.xy2pixel(xy)
                            ctx.lineTo(wh[0], wh[1])
                            if (allPathDisnow >= bias_Q) break
                            tL += tLres
                        }
                        while (tL <= tL0) {
                            q0 = arcPoint(t0,R,eps,tL-tLres,D)
                            q01 = arcPoint(t0,R,eps,tL,D)
                            t0q = Math.atan2(q01[1] - q0[1], q01[0] - q0[0])
                            xy = moveDistanceDirection(q0, H_Q, t0q + d_Q * Math.PI / 2)
                            xy[0] += pp[0]
                            xy[1] += pp[1]
                            var wh = dsp.xy2pixel(xy)
                            allpoints.push(xy)
                            w = wh[0]
                            h = wh[1]
                            ctx.lineTo(w, h)
                            var disnow = 0
                            while (disnow < W_Q) {
                                tL += tLres/5
                                if (tL > tL0) break;
                                disnow += norm(arcPoint(t0,R,eps,tL,D),arcPoint(t0,R,eps,tL- tLres/5,D))
                            }
                            
                            q0 = arcPoint(t0,R,eps,tL-tLres,D)
                            q01 = arcPoint(t0,R,eps,tL,D)
                            t0q = Math.atan2(q01[1] - q0[1], q01[0] - q0[0])
                            xy = moveDistanceDirection(q0, H_Q, t0q + d_Q * Math.PI / 2)
                            xy[0] += pp[0]
                            xy[1] += pp[1]
                            wh = dsp.xy2pixel(xy)
                            allpoints.push(xy)
                            w = wh[0]
                            h = wh[1]
                            ctx.lineTo(w, h)
                            xy = q0
                            xy[0] += pp[0]
                            xy[1] += pp[1]
                            wh = dsp.xy2pixel(xy)
                            allpoints.push(xy)
                            w = wh[0]
                            h = wh[1]
                            ctx.lineTo(w, h)
                            disnow = 0
                            while (disnow < WF_Q) {
                                tL += tLres
                                if (tL >= tL0) break;
                                xy=arcPoint(t0,R,eps,tL,D)
                                xyL=arcPoint(t0,R,eps,tL-tLres,D)
                                disnow += norm(xy,xyL)
                                xy[0] += pp[0]
                                xy[1] += pp[1]
                                wh = dsp.xy2pixel(xy)
                                allpoints.push(xy)
                                w = wh[0]
                                h = wh[1]
                                ctx.lineTo(w, h)
                            }
                            N_Qi += 1
                            if (N_Qi >= N_Q) {
                                while (tL < tL0) {
                                    tL += tLres
                                    xy=arcPoint(t0,R,eps,tL,D)
                                    xy[0] += pp[0]
                                    xy[1] += pp[1]
                                    wh = dsp.xy2pixel(xy)
                                    allpoints.push(xy)
                                    w = wh[0]
                                    h = wh[1]
                                    ctx.lineTo(w, h)
                                }
                            }
                        }
                    } else {
                        while (tL <= tL0) {
                            xy=[(R/2-eps*tL/360)*Math.cos((t0+D*tL)/180*Math.PI),(R/2-eps*tL/360)*Math.sin((t0+D*tL)/180*Math.PI)]
                            xy[0] += pp[0]
                            xy[1] += pp[1]
                            wh = dsp.xy2pixel(xy)
                            allpoints.push(xy)
                            ctx.lineTo(wh[0], wh[1])
                            tL += tLres
                        }
                    }
                    ctx.lineTo(startPoint[0], startPoint[1])
                }
               
               
               
               
               
               
               
               
               
            
               
               
                if (iijj == currentIndex) {
                    ctx.strokeStyle = 'rgba(255,0,0,1)'
                    if (isdrawboundingrect && 0) {
                        ctx.rect(startPoint_[0], startPoint_[1], startPoint[0] - startPoint_[0], startPoint[1] - startPoint_[1])
                        var WH = dsp.pixel2xyLen([Math.abs(startPoint[0] - startPoint_[0]), Math.abs(startPoint[1] - startPoint_[1])])
                        ctx.fillText(Math.round(100 * WH[1]) / 100, startPoint[0], (startPoint[1] + startPoint_[1]) / 2)
                        ctx.fillText(Math.round(100 * WH[0]) / 100, (startPoint[0] + startPoint_[0]) / 2, startPoint[1]);
                        ctx.fillText(ii, (startPoint[0] + startPoint_[0]) / 2, (startPoint[1] + startPoint_[1]) / 2);
                        if (onepath[0] == 4) {
                            ctx.stroke();
                            ctx.beginPath();
                            ctx.strokeStyle = 'rgba(0,255,0,1)'
                            wh = dsp.xy2pixel([p0.x, p0.y])
                            var dc = 2
                            ctx.rect(wh[0] - dc, wh[1] - dc, 2 * dc, 2 * dc)
                            wh = dsp.xy2pixel([p1.x, p1.y])
                            dc = 40
                            ctx.rect(wh[0] - dc, wh[1] - dc, 2 * dc, 2 * dc)
                            wh = dsp.xy2pixel([p2.x, p2.y])
                            dc = 6
                            ctx.rect(wh[0] - dc, wh[1] - dc, 2 * dc, 2 * dc)
                            wh = dsp.xy2pixel([p3.x, p3.y])
                            dc = 10
                            ctx.rect(wh[0] - dc, wh[1] - dc, 2 * dc, 2 * dc)
                        }
                    }
                } else {
                    ctx.strokeStyle = 'rgba(0,0,0,1)'
                }
                ctx.stroke();
            }
            if (startAngs.length > currentIndex) {
                if (currentIndex >= 0) {
                    var Comx = ''
                    if (currentIndex >= 1) {
                        Comx += Math.round(startAngs[currentIndex - 1] / Math.PI * 1800) / 10 + "," + Math.round(endAngs[currentIndex - 1] / Math.PI * 1800) / 10 + "("
                    } else {
                        Comx += "-,-("
                    }
                    Comx += Math.round(startAngs[currentIndex] / Math.PI * 1800) / 10 + "," + Math.round(endAngs[currentIndex] / Math.PI * 1800) / 10 + "("
                    if (startAngs.length > currentIndex + 1) {
                        Comx += Math.round(startAngs[currentIndex + 1] / Math.PI * 1800) / 10 + "," + Math.round(endAngs[currentIndex + 1] / Math.PI * 1800) / 10
                    } else {
                        Comx += "-,-"
                    }
                    ctx.fillText(Comx, 10, 10)
                }
            }
            var scatterimagedata = ctx.getImageData(0, 0, c.width / 2, c.height / 2);
            for (var i = 0; i < scatterimagedata.data.length; i += 4) {
                scatterimagedata.data[i] = 255 - scatterimagedata.data[i]; // red
                scatterimagedata.data[i + 1] = 255 - scatterimagedata.data[i + 1]; // green
                scatterimagedata.data[i + 2] = 255 - scatterimagedata.data[i + 2]; // blue
            }
            //ctx.putImageData( scatterimagedata, 0,0);
            ctx.closePath();
        }
        function arcPoint(t0,R,eps,theta,dir){
            return [(R/2-eps*theta/360)*Math.cos((t0+dir*theta)/180*Math.PI),(R/2-eps*theta/360)*Math.sin((t0+dir*theta)/180*Math.PI)]
        }
        function getStartPoint(i) {
            var ind = i - 1
            if (ind >= snr.shapes.length) {
                return [0, 0]
            }
            if (ind < 0) {
                return [0, 0]
            }
            return [snr.shapes[ind][1], snr.shapes[ind][2]]
        }
        var toolButton_Shape_N = 0
        function btnshapetool(N) {
            toolButton_Shape_N = N
            if (N == 1) {
                if (currentIndex >= snr.shapes.length) {
                    currentIndex = snr.shapes.length
                    var pp = getStartPoint(currentIndex)
                    snr.shapes.push([1, pp[0] + 10, pp[1] + 10, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
                    currentIndex = snr.shapes.length - 1
                    repaint()
                    return
                }
                if (currentIndex < 0) {
                    currentIndex = snr.shapes.length
                    var pp = getStartPoint(currentIndex)
                    snr.shapes.push([1, pp[0] + 10, pp[1] + 10, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
                    currentIndex = snr.shapes.length - 1
                    repaint()
                    return
                }
                if (snr.shapes[currentIndex][0] != N) {
                    currentIndex = snr.shapes.length
                    var pp = getStartPoint(currentIndex)
                    snr.shapes.push([1, pp[0] + 10, pp[1] + 10, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
                    currentIndex = snr.shapes.length - 1
                    repaint()
                    return
                }
                var pp = getStartPoint(currentIndex)
                var ee = [snr.shapes[currentIndex][1], snr.shapes[currentIndex][2]]
                document.getElementById('lineWidthInput').value = ee[0] - pp[0]
                document.getElementById('lineHeightInput').value = ee[1] - pp[1]
                document.getElementById('LineClickedHidden').click()
            }
            if (N == 4) {
                if (0) {
                    if (currentIndex >= snr.shapes.length) {
                        currentIndex = snr.shapes.length
                        var pp = getStartPoint(currentIndex)
                        snr.shapes.push([4, pp[0] + 10, pp[1] + 10, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
                        currentIndex = snr.shapes.length - 1
                        repaint()
                        return
                    }
                    if (currentIndex < 0) {
                        currentIndex = snr.shapes.length
                        var pp = getStartPoint(currentIndex)
                        snr.shapes.push([4, pp[0] + 10, pp[1] + 10, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
                        currentIndex = snr.shapes.length - 1
                        repaint()
                        return
                    }
                    if (snr.shapes[currentIndex][0] != 1) {
                        currentIndex = snr.shapes.length
                        var pp = getStartPoint(currentIndex)
                        snr.shapes.push([4, pp[0] + 10, pp[1] + 10, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
                        currentIndex = snr.shapes.length - 1
                        repaint()
                        return
                    }
                    var pp = getStartPoint(currentIndex)
                    var ee = [snr.shapes[currentIndex][1], snr.shapes[currentIndex][2]]
                    document.getElementById('bzWidthInput').value = ee[0] - pp[0]
                    document.getElementById('bzHeightInput').value = ee[1] - pp[1]
                }
                document.getElementById('bzClickedHidden').click()
            }
            if (N == 5) {
                document.getElementById('sinClickedHidden').click()
            }
            if (N == 6) {
                document.getElementById('chinClickedHidden').click()
            }
            if (N == 3) {
                document.getElementById('arcClickedHidden').click()
            }
        }
        const c = document.getElementById('myCanvas');
        c.addEventListener('wheel', wheelhandle);
        c.addEventListener('mousemove', mousemovehandle);
        c.addEventListener('touchmove', touchmovehandle);
        c.addEventListener('touchstart', touchstarthandle);
        c.addEventListener('touchend', touchendhandle);
        c.addEventListener('mousedown', mousedownhandle);
        c.addEventListener('mouseup', mouseuphandle);
        var mouseOption = 0
        var mousePos
        function movehandle(mP) {
            var so = document.getElementById('sel2').selectedIndex
            if(so==0){
                dsp.bias = [dsp.bias[0] - mP[0] / dsp.scale, dsp.bias[1] + mP[1] / dsp.scale]
            }
            else if(so==6){
                dsp.bias_image = [dsp.bias_image[0] + mP[0] / dsp.scale, dsp.bias_image[1] + mP[1] / dsp.scale]
            }
            else if(so==7){
                if(mP[0]>0) dsp.scale_image *= 1.02 
                if(mP[0]<0) dsp.scale_image /= 1.02 
            }
            else{
                if(currentIndex<snr.shapes.length){
                    if(currentIndex>=0){
                        if(toolButton_Shape_N==6){
                            if(snr.shapes[currentIndex][11]==1){ //chin          
                                if(so==1){
                                    snr.shapes[currentIndex][12] +=mP[0] / dsp.scale/10
                                    if(snr.shapes[currentIndex][12]<=0)snr.shapes[currentIndex][12]=0
                                    comment.innerHTML=snr.shapes[currentIndex][12]
                                }
                                if(so==2){
                                    snr.shapes[currentIndex][13] +=mP[0] / dsp.scale/10
                                    if(snr.shapes[currentIndex][13]<=0)snr.shapes[currentIndex][13]=0
                                    comment.innerHTML=snr.shapes[currentIndex][13]
                                }
                                if(so==3){
                                    snr.shapes[currentIndex][14] +=mP[0] / dsp.scale/10
                                    if(snr.shapes[currentIndex][14]<=0)snr.shapes[currentIndex][14]=0
                                    comment.innerHTML=snr.shapes[currentIndex][14]
                                }
                                if(so==4){
                                    snr.shapes[currentIndex][15] +=mP[0] / dsp.scale/10
                                    if(snr.shapes[currentIndex][15]<=0)snr.shapes[currentIndex][15]=0
                                    comment.innerHTML=snr.shapes[currentIndex][15]
                                }
                                if(so==5){
                                    snr.shapes[currentIndex][16] +=mP[0] 
                                    if(snr.shapes[currentIndex][16]<=0)snr.shapes[currentIndex][16]=0
                                    comment.innerHTML=snr.shapes[currentIndex][16]
                                }
                                if(so==5){
                                    snr.shapes[currentIndex][17] =1
                                    if(mP[0]<0)snr.shapes[currentIndex][17]=-1
                                    comment.innerHTML=snr.shapes[currentIndex][17]
                                }
                                }
                        }
                        else{
                        if(snr.shapes[currentIndex][0]==1){//line
                            snr.shapes[currentIndex][1]+=mP[0] / dsp.scale
                            snr.shapes[currentIndex][2]-=mP[1] / dsp.scale
                        }
                        if(snr.shapes[currentIndex][0]==3){ //arc
                            var pp = getStartPoint(currentIndex)
                            var t0=snr.shapes[currentIndex][3]
                            var tL=snr.shapes[currentIndex][4]
                            var R=snr.shapes[currentIndex][5]
                            var D=snr.shapes[currentIndex][6]
                            var eps=snr.shapes[currentIndex][7]
                            if(so==1){
                                R+=mP[0] / dsp.scale
                                if(R<=1)R=1
                            }
                            if(so==2){
                                tL+=mP[0]
                                if(tL<=1)tL=1
                            }
                            if(so==3){
                                t0+=mP[0]
                            }
                            if(so==4){
                                eps+=mP[0] / dsp.scale
                                if(eps<=0)eps=0
                            }
                            if(so==5){
                                if(mP[0]>0)D=1
                                else D=-1
                            }
                            var xy=[(R/2-eps*0/360)*Math.cos((t0+D*0)/180*Math.PI),(R/2-eps*0/360)*Math.sin((t0+D*0)/180*Math.PI)]
                            pp[0]-=xy[0]
                            pp[1]-=xy[1]
                            xy=[(R/2-eps*tL/360)*Math.cos((t0+D*tL)/180*Math.PI),(R/2-eps*tL/360)*Math.sin((t0+D*tL)/180*Math.PI)]
                            snr.shapes[currentIndex][1]=pp[0] + xy[0]
                            snr.shapes[currentIndex][2]=pp[1] + xy[1]
                            snr.shapes[currentIndex][3]=t0
                            snr.shapes[currentIndex][4]=tL
                            snr.shapes[currentIndex][5]=R
                            snr.shapes[currentIndex][6]=D
                            snr.shapes[currentIndex][7]=eps
                        }
                        if(snr.shapes[currentIndex][0]==4){ //bz
                            if(so==1){
                                snr.shapes[currentIndex][1]+=mP[0] / dsp.scale
                                snr.shapes[currentIndex][2]-=mP[1] / dsp.scale
                            }
                            if(so==2){
                                snr.shapes[currentIndex][3]+=mP[0] / dsp.scale
                                snr.shapes[currentIndex][4]-=mP[1] / dsp.scale
                            }
                            if(so==3){
                                snr.shapes[currentIndex][5]+=mP[0] / dsp.scale
                                snr.shapes[currentIndex][6]-=mP[1] / dsp.scale
                            }
                        }
                        if(snr.shapes[currentIndex][0]==5){ //sin
                        
                            var pp = getStartPoint(currentIndex)
                            var N = snr.shapes[currentIndex][3]
                            var d = snr.shapes[currentIndex][4]
                            var H = snr.shapes[currentIndex][5]
                            var t = snr.shapes[currentIndex][6]
                            var st = snr.shapes[currentIndex][7]
                            
                            if(so==1){
                                d+=mP[0] / dsp.scale/10
                                if(d<=.1)d=.1
                                comment.innerHTML=d
                            }
                            if(so==2){
                                H+=mP[0]/ dsp.scale
                                if(H<=0)H=0
                                comment.innerHTML=H
                            }
                            if(so==3){
                                N+=mP[0] / 50
                                if(N<=.1)N=.1
                                comment.innerHTML=N
                            }
                            if(so==4){
                                t+=mP[0]/100
                                comment.innerHTML=t
                            }
                            if(so==5){
                                st+=mP[0]/100
                                comment.innerHTML=st
                            }
                            var xy = rot(0, H * Math.sin(st), t)
                                    pp[0]-=xy[0]
                                    pp[1]-=xy[1]
                            var x = N * d
                            var y = H * Math.sin(2 * Math.PI * x / d + st)
                            var xy = rot(x, y, t)
                            snr.shapes[currentIndex][1]=pp[0] + xy[0]
                            snr.shapes[currentIndex][2]=pp[1] + xy[1]
                            snr.shapes[currentIndex][3]=N
                            snr.shapes[currentIndex][4]=d
                            snr.shapes[currentIndex][5]=H
                            snr.shapes[currentIndex][6]=t
                            snr.shapes[currentIndex][7]=st
                        }
                        }
                    }
                }
            }
            repaint()
            return;
            var Pos = [mP[0] - c.offsetLeft, mP[1] - c.offsetTop]
            var PosX = [mP[1] - c.offsetLeft, mP[1] - c.offsetTop]
            var dPos = [mousePos[0] - Pos[0], mousePos[1] - Pos[1]]
            dPos = dsp.pixel2xyLen(dPos)
            mousePos = Pos
            if (mouseOption == 1) {
                dsp.bias[0] += dPos[0]
                dsp.bias[1] += dPos[1]
                repaint()
                return
            }
            if (toolButton_Shape_N == 1) {
                PosX = dsp.pixel2xy(PosX)
                snr.shapes[currentIndex][1] = PosX[0]
                snr.shapes[currentIndex][2] = PosX[1]
                repaint()
            }
            if (toolButton_Shape_N == 4) {
                PosX = dsp.pixel2xy(PosX)
                snr.shapes[currentIndex][5] = PosX[0]
                snr.shapes[currentIndex][6] = PosX[1]
                repaint()
            }
        }
        function mousemovehandle(e) {
            if (dsp.mousePressed == 0) return;
            var dx = e.pageX-mouseP[0]
            var dy = e.pageY-mouseP[1]
            mouseP =  [e.pageX,e.pageY]
            movehandle([dx,dy])
        }
        var touchP
        var mouseP
        function touchmovehandle(e) {
            var dx = e.touches[0].pageX-touchP[0]
            var dy = e.touches[0].pageY-touchP[1]
            movehandle([dx,dy])
            touchP = [e.touches[0].pageX,e.touches[0].pageY]
        }
        function touchstarthandle(e) {
            touchP = [e.touches[0].pageX,e.touches[0].pageY]
        }
        function touchendhandle(e) {
        }
        function mousedownhandle(e) {
            dsp.mousePressed = 1
            mouseP =  [e.pageX,e.pageY]
        }
        function mouseuphandle(e) {
            dsp.mousePressed = 0
        }
        var NZI = 0
        function btnzintool() {
            NZI = 0
            setTimeout(btnzintoolanim, 1)
        }
        function btnzintoolanim() {
            dsp.scale *= 1.01
            repaint()
            NZI += 1
            if (NZI > 20) {
                clearTimeout(btnzintoolanim)
            } else {
                setTimeout(btnzintoolanim, 1)
            }
        }
        function btnzouttool() {
            NZI = 0
            setTimeout(btnzouttoolanim, 1)
        }
        function btnzouttoolanim() {
            dsp.scale /= 1.01
            repaint()
            NZI += 1
            if (NZI > 20) {
                clearTimeout(btnzouttoolanim)
            } else {
                setTimeout(btnzouttoolanim, 1)
            }
        }
        var movePanParameter = 1
        function btnpantoolanim() {
            N = NPAN
            if (N == 1) {
                dsp.bias = [dsp.bias[0] + movePanParameter / dsp.scale, dsp.bias[1]]
            }
            if (N == 2) {
                dsp.bias = [dsp.bias[0] - movePanParameter / dsp.scale, dsp.bias[1]]
            }
            if (N == 3) {
                dsp.bias = [dsp.bias[0], dsp.bias[1] + movePanParameter / dsp.scale]
            }
            if (N == 4) {
                dsp.bias = [dsp.bias[0], dsp.bias[1] - movePanParameter / dsp.scale]
            }
            repaint()
            NZI += 1
            if (NZI > 20) {
                clearTimeout(btnpantoolanim)
            } else {
                setTimeout(btnpantoolanim, 1)
            }
        }
        var NPAN = 0
        function btnpantool(N) {
            if (N == 5) {
                dsp.bias = [0, 0]
                dsp.scale = 5
                repaint()
                return
            }
            NZI = 0
            NPAN = N
            setTimeout(btnpantoolanim, 1)
            if (mouseOption == 0) {
                mouseOption = 1
            } else {
                mouseOption = 0
            }
        }
        function btndeltool() {
            if (currentIndex >= snr.shapes.length) return
            snr.shapes.splice(currentIndex, 1)
            if (currentIndex > 0) currentIndex -= 1
            repaint()
        }
        const comment = document.getElementById('comment');
        //command.addEventListener('keyup', updateValue);
        //range.addEventListener('input', updateRange);
        //document.addEventListener('keyup', keyhandle);
        document.getElementById('avatar').addEventListener('change', filehandle);
        document.getElementById('fileopenx').addEventListener('change', filehandle2);
       // document.getElementById('filesavex').addEventListener('change', filesavehandle);
        var img = new Image;
        var imloaded = 0;
        img.onload = function() {
            dsp.loaded_image = 1;
            repaint()
        }
        function updateRange(e) {}
        var downloadBlob, downloadURL;
        downloadBlob = function(data, fileName, mimeType) {
            var blob, url;
            blob = new Blob([data], {
                type: mimeType
            });
            url = window.URL.createObjectURL(blob);
            downloadURL(url, fileName);
            setTimeout(function() {
                return window.URL.revokeObjectURL(url);
            }, 1000);
        };
        downloadURL = function(data, fileName) {
            var a;
            a = document.createElement('a');
            a.href = data;
            a.download = fileName;
            document.body.appendChild(a);
            a.style = 'display: none';
            a.click();
            a.remove();
        };
        var allpoints = []
        function filedownload() {
            var md = new Float64Array(allpoints.length * 2);
            for (var i = 0; i < allpoints.length; i++) {
                md[2 * i] = allpoints[i][0]
                md[2 * i + 1] = allpoints[i][1]
            }
            downloadBlob(md, saveasfilename + '.aig', 'application/octet-stream');
        }
        var saveasfilename = 'File'
        function filehandle(e) {
            img.src = URL.createObjectURL(e.target.files[0]);
        }
        function filesavehandle() {
            var N = snr.shapes.length
            if(N==0)return
            var M = snr.shapes[0].length
            var md = new Float64Array(N*M)
            for (var i = 0; i < N; i++) {
                for (var j = 0; j < M; j++) {
                    md[i*M+j] = snr.shapes[i][j]
                }
            }
            downloadBlob(md, saveasfilename + '.aigjs', 'application/octet-stream');
        }
        function filehandle2(e) {
            reader.readAsBinaryString(e.target.files[0])
        }
        var reader = new FileReader();
        reader.onload = function() {
            var res = reader.result
            var buf = new ArrayBuffer(res.length)
            var bufView = new Uint8Array(buf);
            for (var i = 0; i < res.length; i++) {
                bufView[i] = res.charCodeAt(i);
            }
            var dv = new DataView(buf)
            var k=0
            var N = 21
            snr.shapes=[]
            for (var i = 0; i < res.length/8 / N; i++) {
                var sh = []
                for(var j=0;j<N;j++){
                sh.push(dv.getFloat64(8*k,true))
                 k++
                }
                snr.shapes.push(sh)
            }
            repaint()
        };
        function btnnextgallery(){
            galleryi++
            if(galleryi>=gallery.length)galleryi=gallery.length-1
            if(galleryi<0)galleryi=0
            if(galleryi>=gallery.length)return
            snr.shapes = gallery[galleryi]
            repaint()
        }
        function btnpregallery(){
            galleryi--
            if(galleryi<0)galleryi=0
            if(galleryi>=gallery.length)return
            snr.shapes = gallery[galleryi]
            repaint()
        }
        function btnsavegallery(){
            var ss = "gallery.push(["
            for(var i=0;i<snr.shapes.length;i++){
                ss+="["
                for(var j=0;j<snr.shapes[i].length;j++){
                    if(j==snr.shapes[i].length-1)ss+=snr.shapes[i][j]
                    else ss+=snr.shapes[i][j]+","
                }
                if(i==snr.shapes.length-1)ss+="]"
                else ss+="],"
            }
            
            ss+="])"
            comment.innerHTML=ss
        }
        var galleryi=0
var gallery =[]
gallery.push([[1,27,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[3,27,10.432454100139857,-83,166,10.510800009539356,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,17.247432442100678,8.712597349119605,17.6456270183901,8.69112972547576,20.015935125338032,11.851540534739616,0,0,0,1,1,0.2,0.5,0.507035350657093,1,1000,1,0,0,0],[4,0.3839405633575649,5.80758654462537,8.296078374317732,9.349548644072364,11.061437832423628,5.135667565053837,0,0,0,1,1,0.6,0.5,0.5,1,1000,1,0,0,0],[4,0,0,-2.9475179607417905,0.24884735158817645,-0.9849490919930193,5.346866499390678,0,0,0,1,0,0,0,0,0,0,0,0,0,0]])
gallery.push([[3,0,-1.2246467991473533e-15,0,360,10,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,-10,-1.2246467991473533e-15,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0]])
gallery.push([[1,30.555130912570867,-0.07406522734522657,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[3,31.417246845509982,7.492629204624259,-60,107,9.47388682670619,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,20.358171990600184,9.89764098664322,21.824963888427067,10.530497834172962,26.527986394009496,13.048715563910678,0,0,0,1,0,3,0.5,0.5,1,1000,1,0,0,0],[4,1.12459283680983,7.9554781376369395,8.518274056353414,9.942070462834169,8.76541578472161,3.7284282454945354,0,0,0,1,0,3,0.5,0.5,1,1000,1,0,0,0],[4,0,0,-2.577191824015656,-0.04741355779272946,-2.0218622748261894,7.272562410366569,0,0,0,1,0,0,0,0,0,0,0,0,0,0]])
gallery.push([[4,3.11472016635539,3.225773066898048,3.4426399168223036,-0.4442116021706197,0.44421160217061995,0.4442116021706197,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,6.0073345316254825,5.007858426741584,5.441592126590087,4.775274723334161,4.775274723334156,5.108433424962126,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,16.784704835424055,5.124150278445293,11.21634295480816,0.8884232043412392,8.328967540699118,3.775798618450268,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,17.90047279201166,3.9078073236371424,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,24.90204447735997,2.9135701699143026,18.878993092251356,-3.99790441953558,16.657935081398257,2.3321109113957545,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,24.463071826350394,8.915665750378725,25.209008423182592,9.217390745040346,27.652172235121103,6.330015330931324,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,21.025670860689146,12.696703319990034,21.322156904189736,10.883184253180188,23.876373616670822,13.326348065118601,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,26.472501938440335,18.365640198826508,20.43373369984854,13.104242264033264,20.211627898763226,16.768987981940892,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,28.14353439774121,20.36983135975539,26.652696130237207,19.43425759496465,27.874278036206398,19.545310495507263,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,29.814566857042095,21.37454641580037,28.873754141090235,20.21162789876325,29.20691284271825,21.32215690418976,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,30.819281913087043,22.712420173473284,33.20481726225381,21.211104003647126,30.317441848144817,20.766892401476493,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,31.82399696913198,24.827664234944834,33.0937643617112,23.099003312872277,29.42901864380359,23.65426781558552,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,30.60765401432386,25.832379290989795,28.984807041632898,23.32110911395753,31.20586505248606,25.875325826438598,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,29.058152357887714,26.7260414464921,31.205865052486036,28.540595439462333,30.983759251400706,26.541643229694532,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,27.397597800908922,25.620751392226612,28.873754141090277,26.097431627523914,27.541119334578426,25.431114224268004,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,25.737043243930184,27.180730950984838,25.320061323725298,26.874801931322533,27.09690773240781,28.651648340004954,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,23.188065482610153,23.632277084780924,28.09638383729172,23.543214915042853,24.653743920469406,26.430590329151926,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,21.527510925631375,38.74071050974305,26.65269613023716,34.09324046659505,23.98742651721343,23.65426781558547,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[3,22.082326441352112,40.74131062828511,-35,39,6.219486325504783,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,21.865459591427857,52.40710413642494,25.097955522640046,51.86170455341982,28.42954253891967,42.97747251000747,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,11.986990394292627,46.30443355773997,12.660030661862695,54.08276256427301,21.32215690418974,58.96909018814974,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,10.104330036228548,47.08704281269962,9.994761048838951,45.5316892224885,10.883184253180163,45.97590082465917,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,2.6690246510317244,49.424392675256435,3.220534115736992,54.08276256427291,9.772655247753649,58.96909018814976,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,3.007422303820745,37.213812566725395,-4.553168922248855,33.53797596388167,-8.10686173961382,48.19695883551221,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,4.678454763121619,22.782174447341315,-2.1100051103104387,30.42849474868748,2.554216712481063,35.09271657147896,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,1.1300008969177147,22.787413398502395,1.5547406075971666,21.544262705275052,7.10738563472991,20.544786600391195,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,-0.6416065606037042,23.014758150748783,-1.7768464086824762,23.76532071612818,2.221058010853099,26.985854831865137,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,-4.07900752626495,21.465256494312687,-2.6652696130237556,23.43216201450024,0.33315870162798367,21.10005110310449,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,-3.7406098734759325,19.027331633535333,0.11105290054265748,22.65479171070162,-4.997380524419473,18.43478149008084,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,-2.1806303147177077,18.47730608198312,-3.5536928173649596,17.102146683568833,-4.886327623876815,17.768464086824803,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,-1.0648623581300996,16.03938122120574,-3.9979044195355766,16.102670578684975,-2.220446049250313e-16,19.767416296592607,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,1.0503817033413996,17.266202078335994,0.11105290054265593,18.32372858953808,0.4442116021706195,17.546358285739487,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,6.164054079464581,14.273012714845365,3.6647457179076133,14.436877070545128,1.6657935081398283,15.769511877057008,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,3.9482350197725347,12.723511058409246,5.108433424962121,12.10476615914939,7.107385634729905,13.992665468374527,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,-0.5996949513152607,8.397686888406751,0.7773703037985874,8.773179142869731,-3.1094812151943376,11.216342954808141,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,-2.8873754141090293,1.554740607597167,-6.663174032559306,5.219486325504782,-5.6636979276754,12.771083562405321,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,0,0,-1.4269233267645673,0.2586083485773546,-1.7631725445255702,0.5050880910643277,0,0,0,1,0,0,0,0,0,0,0,0,0,0]])
gallery.push([[5,4.2,0,1,4.2,0.28,0,4.71238898038469,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,6.994503525235996,3.341455402858351,6.159153752356035,0.9036596238977962,4.803664316509331,-0.07134154925508969,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[3,6.694032320967007,8.254116167385954,248,129,5.453048122377617,-1,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[3,3.124759223533303,9.354648119555648,34.36363636363636,77,6,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,3.0656007785657358,10.008905167138973,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[3,4.414525015903572,12.600164517703167,-56.63636363636364,58.27272727272728,6,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[3,1.8174281321663854,9.706576503804579,98.45454545454545,79.27272727272728,6.095122065673454,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,1.3777814245050122,9.100466181214653,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,0.010694576527477045,9.516918064614341,0.5945129104590778,9.46464553450848,0.7134154925508918,9.393303985253379,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[3,-2.953194330968243,7.395693245929813,90.45454545454545,70.27272727272728,6.33292722985708,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[3,-2.977223341843258,4.030334879673049,162.45454545454544,34.27272727272728,11.421957743386782,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,0,0,-1.4268309851017826,0.09512206567345213,-2.592076289601573,2.7347593881117525,0,0,0,1,0,0,0,0,0,0,0,0,0,0]])
gallery.push([[5,4.2,0,1,4.2,0.28,0,4.71238898038469,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,6.994503525235996,3.341455402858351,6.159153752356035,0.9036596238977962,4.803664316509331,-0.07134154925508969,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[3,6.694032320967007,8.254116167385954,248,129,5.453048122377617,-1,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[3,3.027920598734838,9.314806001095166,34.36363636363636,79,6,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[5,0.9279205987348385,9.285687241653719,0.75,2.8,0.2,3.141592653589793,5.394654051618836,0,0,1,0,0,0,0,0,0,0,0,0,0],[3,-0.15028184335689776,9.51129257245211,65.45454545454545,25.454545454545453,5,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[3,-2.981162872695965,7.356867859954774,90.90909090909092,72.72727272727272,6,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[3,-2.1683971431476343,2.005677175562365,165,47.27272727272728,13.5,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,0,0,-0.7411738249188924,0.13897009217229392,-1.2738925115793556,0.37058691245944514,0,0,0,1,0,0,0,0,0,0,0,0,0,0]])
gallery.push([[1,1.3227221156721505,10.12078140875769,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,5.0943216945636465,10.06638204010785,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,6.60592447875573,-0.005736220987041504,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,3.9221635468898595,-0.016574982033444756,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,3.8201649018288855,1.8139902408912914,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,3.3384953322377795,1.8221350260713958,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,3.33141441830934,3.5957496103166116,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,3.7229879751375368,3.584910849270209,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,3.3172525904524597,7.712485165602234,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,2.816599474634849,3.6012004196304086,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,3.322074308822084,3.5903616585840052,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,3.3339769411201523,1.8330366446989974,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,2.8523073715290495,1.8411814298791034,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,2.6933580877885572,-0.011061315138439526,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0]])
gallery.push([[1,3.431693005628722,-0.004328861368970399,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,5.990142884838141,1.3201905131175207,5.770998052857999,0.32272028585061135,5.25844230474234,0.03796709245301344,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,4.58103160270769,5.435291182900478,5.20149166606281,5.315392943421827,6.530339901918264,5.1635245736097914,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,5.013324304548363,9.588358945136456,6.093718338708611,8.827348995325565,6.492372809465241,5.69506386795197,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,1.8767103158058192,10.058618739430148,4.404182724549525,9.890427584009892,4.157396623604939,10.118230138727986,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,0.01199392423920903,10.054289878061182,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,0.007665062870244016,0.026648609096739384,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,2.6040820345326807,1.7498224543398695,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,2.599753173163716,8.35176767979519,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,2.6144078580212624,6.12636390992494,3.7967092453013174,5.865915783990532,4.2523143547374715,8.40971097834241,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,2.6100789966522946,4.489450073076405,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[4,2.586766589056821,1.7325070088639827,4.1004459849254244,1.3668153283084727,4.17638016983145,4.821820741532668,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,-0.01830810534354855,0.01965898710942445,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0]])
        function wheelhandle(e) {
            if (e.deltaY > 0) {
                dsp.scale /= 1.04
            } else {
                dsp.scale *= 1.04
            }
            repaint()
        }
        function keyhandle(e) {
            e = e || window.event;
            if (e.keyCode == '38') {
                // up arrow
                if (draworim == 1) {
                    bias[1] += scale / .100;
                } else {
                    biasim[1] += scaleim / .100;
                }
                paintfunc();
            } else if (e.keyCode == '40') {
                // down arrow
                if (draworim == 1) {
                    bias[1] -= scale / .100;
                } else {
                    biasim[1] -= scaleim / .100;
                }
                paintfunc();
            } else if (e.keyCode == '37') {
                // left arrow
                if (draworim == 1) {
                    bias[0] += scale / .100;
                } else {
                    biasim[0] += scaleim / .100;
                }
                paintfunc();
            } else if (e.keyCode == '39') {
                if (draworim == 1) {
                    bias[0] -= scale / .100;
                } else {
                    biasim[0] -= scaleim / .100;
                }
                paintfunc();
                // right arrow
            }
        }
        function bezier(t, p0, p1, p2, p3) {
            var cX = 3 * (p1.x - p0.x),
                bX = 3 * (p2.x - p1.x) - cX,
                aX = p3.x - p0.x - cX - bX;
            var cY = 3 * (p1.y - p0.y),
                bY = 3 * (p2.y - p1.y) - cY,
                aY = p3.y - p0.y - cY - bY;
            var x = (aX * Math.pow(t, 3)) + (bX * Math.pow(t, 2)) + (cX * t) + p0.x;
            var y = (aY * Math.pow(t, 3)) + (bY * Math.pow(t, 2)) + (cY * t) + p0.y;
            return {
                x: x,
                y: y
            };
        }
    </script>

</body>

</html>
